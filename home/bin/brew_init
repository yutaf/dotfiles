#!/usr/bin/env bash

# Referred from http://lapwinglabs.com/blog/hacker-guide-to-setting-up-your-mac

PARALLEL=10

if ! type brew > /dev/null 2>&1; then
  echo "Installing homebrew..."
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  # Update & Upgrade homebrew
  brew update && brew upgrade
else
  # Update homebrew
  brew update
fi

# Install GNU core utilities (those that come with OS X are outdated)
brew install coreutils 2> /dev/null || true
# Install GNU `find`, `locate`, `updatedb`, and `xargs`, g-prefixed
brew install findutils 2> /dev/null || true
# Install GNU `sed`
brew install gnu-sed 2> /dev/null || true

# tap
TAP_LIST="
homebrew/dupes
homebrew/versions
homebrew/completions
peco/peco
"
echo "$TAP_LIST" | xargs -t -n $PARALLEL -P $PARALLEL -I % brew tap % 2> /dev/null || true

#taps=(
#  homebrew/dupes
#  homebrew/versions
#  homebrew/completions
#  peco/peco
#)
#
#for tap in ${taps[@]}; do
#  brew tap $tap 2> /dev/null || true
#done

# Install other useful binaries
BINARY_LIST="
bash-completion
vagrant-completion

direnv
jq
nkf
peco
pwgen
rename
rmtrash
tree
wget

git
git-flow
hub
tig

node

autoconf
"

# Install the binaries
echo "$BINARY_LIST" | xargs -t -n $PARALLEL -P $PARALLEL -I % brew install % 2> /dev/null || true

#binaries=(
#  bash-completion
#  vagrant-completion
#
#  direnv
#  jq
#  nkf
#  peco
#  pwgen
#  rename
#  rmtrash
#  tree
#  wget
#
#  git
#  git-flow
#  hub
#  tig
#
#  node
#
#  autoconf
#)
#
## Install the binaries
#brew install ${binaries[@]} 2> /dev/null || true

#  vim for NeoBundle
brew install vim --with-lua 2> /dev/null || true

# wireshark
brew install wireshark --with-qt 2> /dev/null || true

# Install homebrew-cask
brew install caskroom/cask/brew-cask 2> /dev/null || true

# Tap alternative versions
brew tap caskroom/versions 2> /dev/null || true

# TODO apps
APP_LIST="
iterm2
dropbox
google-chrome
firefox
vagrant
virtualbox
transmit
slack
skype
appcleaner
send-to-kindle
magican
"
# install apps
echo "$APP_LIST" | xargs -t -n $PARALLEL -P $PARALLEL -I % brew cask install % 2> /dev/null || true

#apps=(
#  iterm2
#  dropbox
#  google-chrome
#  firefox
#  vagrant
#  virtualbox
#  transmit
#  slack
#  skype
#  appcleaner
#  send-to-kindle
#  magican
#)
#
## install apps
#brew cask install ${apps[@]} 2> /dev/null || true

# Remove outdated versions from the cellar
brew cleanup
